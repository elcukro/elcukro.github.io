---
title: ""
date: 2009-10-19
draft: false
tags: ["migrated-from-gist"]
gist_id: "213330"
---

<?php
	// get request token
	public static function getRequestToken($endpoint='http://blip.pl/oauth/request_token') {
		$test_consumer = new OAuthConsumer(self::$app_key, self::$app_secret, 'oob');
		$req_req = OAuthRequest::from_consumer_and_token($test_consumer, NULL, 'GET', $endpoint, array());
		$req_req->set_parameter('oauth_callback', urlencode('oob'));
		$req_req->sign_request(new OAuthSignatureMethod_HMAC_SHA1(), $test_consumer, NULL);

		return file_get_contents($req_req);
	} // getRequestToken

	// get access token
	public static function getAccessToken($token, $secret, $verifier, $endpoint='http://blip.pl/oauth/access_token') {
		$test_consumer = new OAuthConsumer(self::$app_key, self::$app_secret, NULL);
		$test_token = new OAuthConsumer($token, $secret);

		$acc_req = OAuthRequest::from_consumer_and_token($test_consumer, $test_token, 'GET', $endpoint,
			array(
				'oauth_verifier' => $verifier,
				'oauth_callback' => 'oob'
			)
		);

		$acc_req->sign_request(new OAuthSignatureMethod_HMAC_SHA1(), $test_consumer, $test_token);
		return file_get_contents($acc_req);
	} // get access token


	if (@$_GET['oauth_token']!='' && @$_GET['oauth_verifier']!='') {
		$ret = oauth_blipapi::getAccessToken($_GET['oauth_token'], $_SESSION['oauth_secret'], $_GET['oauth_verifier']);
		$params = parse_url('?'.$ret);
		parse_str($params['query'], $params);

		$access_token = $_SESSION['access_token'] = $params['oauth_token'];
		$access_token_secret = $_SESSION['access_token_secret'] = $params['oauth_token_secret'];

		Header('Location: index.php');
		exit(0);
	} else if (@$_REQUEST['action']=='authorize') { // POBIERZ TOKEN I PRZEKIERUJ NA AUTHORIZE

		$ret = oauth_blipapi::getRequestToken();

		$params = parse_url('?'.$ret);
		parse_str($params['query'], $params);

		if ( @$params['oauth_token'] && @$params['oauth_token_secret']) {
			$oauth_token = $_SESSION['oauth_token'] = $params['oauth_token'];
			$oauth_secret = $_SESSION['oauth_secret'] = $params['oauth_token_secret'];

			// AUTHORIZE
			$endpoint = 'http://blip.pl/oauth/authorize';
			$auth_req = $endpoint . '?oauth_token=' . $oauth_token;
			Header("Location: $auth_req");
			exit;
		} else {
			print "problem fetching request token.<br>\n";
		}
?>
