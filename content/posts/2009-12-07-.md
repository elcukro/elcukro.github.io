---
title: ""
date: 2009-12-07
draft: false
tags: ["migrated-from-gist"]
gist_id: "250921"
---

	if (@$_GET['oauth_token']!='' && @$_GET['oauth_verifier']!='') {
		$ret = oauth_blipapi::getAccessToken($_GET['oauth_token'], $_SESSION['oauth_secret'], $_GET['oauth_verifier']);
		$params = parse_url('?'.$ret);
		parse_str($params['query'], $params);

		$access_token = $_SESSION['access_token'] = $params['oauth_token'];
		$access_token_secret = $_SESSION['access_token_secret'] = $params['oauth_token_secret'];

		setcookie("at", $access_token, time()+60*60*24*7); // expire in 1 week
		setcookie("ats", $access_token_secret, time()+60*60*24*7); // expire in 1 week

		$blipapi = new oauth_blipapi($access_token, $access_token_secret);
		$blipuser = $blipapi->getLoggedBlipUser();
		$_SESSION['blipuser'] = $blipuser;
		$_SESSION['logged'] = true;
		Header('Location: index.php');
		exit(0);
	} else if (@$_REQUEST['action']=='authorize') { // POBIERZ TOKEN I PRZEKIERUJ NA AUTHORIZE

		$ret = oauth_blipapi::getRequestToken();

		$params = parse_url('?'.$ret);
		parse_str($params['query'], $params);

		if ( @$params['oauth_token'] && @$params['oauth_token_secret']) {
			$oauth_token = $_SESSION['oauth_token'] = $params['oauth_token'];
			$oauth_secret = $_SESSION['oauth_secret'] = $params['oauth_token_secret'];

			// AUTHORIZE
			$endpoint = 'http://blip.pl/oauth/authorize';
			$auth_req = $endpoint . '?oauth_token=' . $oauth_token;
			Header("Location: $auth_req");
			exit;
		} else {
			print "problem fetching request token.<br>\n";
		}
	}
